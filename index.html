<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>è³“æœ 1-99 é æ¸¬å™¨ï¼ˆè¡°æ¸›æ¬Šé‡ + æŠ½æ¨£ Top10ï¼‰</title>
<style>
body{background:#0f172a;color:#e5e7eb;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;margin:0;padding:16px;}
.card{background:#111827cc;padding:14px;border-radius:16px;margin-bottom:12px;box-shadow:0 10px 25px rgba(15,23,42,.6);}
.btn{padding:8px 12px;border-radius:999px;border:0;background:linear-gradient(135deg,#22d3ee,#60a5fa);color:#020617;font-weight:700;cursor:pointer;}
.btn.sec{background:#020617;color:#e5e7eb;border:1px solid rgba(148,163,184,.25);}
input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:#020617;color:#e5e7eb;box-sizing:border-box;}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-top:4px;}
.divider{border-top:1px dashed rgba(148,163,184,.4);margin:2px 0;}
.mono{white-space:pre-wrap;font-family:ui-monospace,Consolas,monospace;}
label.switch{display:inline-block;font-size:13px;vertical-align:middle;margin:0;padding:0;}
label.switch input{margin-right:4px;vertical-align:middle;}
#strictWrap{display:inline-block;font-size:13px;margin:0;padding:0;}
#strictWrap input{margin-right:3px;vertical-align:middle;}
.split2{display:flex;gap:8px;}
.split2>div{flex:1;display:flex;flex-direction:column;}
#singleTop .chip,#toplist .chip{margin:1px 0;}
.chip{background:#1e293b;border-radius:12px;padding:6px 8px;font-size:13px;border:1px solid rgba(148,163,184,.35);box-shadow:0 4px 10px rgba(15,23,42,.8);display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;}
.chip span.label{color:#e5e7eb;}
.chip span.value{font-weight:600;}
.chip.rankTop{border-color:#38bdf8;box-shadow:0 0 0 1px rgba(56,189,248,.4),0 10px 25px rgba(15,23,42,.9);background:radial-gradient(circle at top,#0ea5e944,#020617);}
.chip.rankTop span.value{color:#7dd3fc;}
.hit-table-wrapper{max-height:260px;overflow:auto;border-radius:10px;border:1px solid rgba(148,163,184,.4);background:#020617;}
.hit-table{width:100%;border-collapse:collapse;font-size:12px;min-width:560px;}
.hit-table thead{position:sticky;top:0;background:#020617;z-index:1;}
.hit-table th,.hit-table td{padding:6px 8px;text-align:left;border-bottom:1px solid rgba(30,64,175,.5);}
.hit-table th{color:#bfdbfe;font-weight:600;}
.hit-table tr:hover{background:#0b1120;}
</style>
</head>
<body>
<h1>è³“æœ 1-99 é æ¸¬å™¨ï¼ˆè¡°æ¸›æ¬Šé‡ + æŠ½æ¨£ Top10ï¼‰</h1>

<div id="stats" style="color:#60a5fa;font-size:13px;line-height:1.4;margin-bottom:8px"></div>
<div style="color:#94a3b8;font-size:13px;margin-bottom:10px">
  å»ºè­°é è¨­ï¼šr=0.80ã€å•Ÿç”¨ã€ŒğŸ” ç†±è™Ÿé€£é–‹æ‡²ç½°ã€èˆ‡ã€Œé¿å…é‡è¤‡ä¸Šä¸€æœŸã€ã€‚<br>
  æ³¨æ„ï¼šè³“æœçµ„åˆæ•¸å·¨å¤§ï¼Œæœ¬å·¥å…·ç”¨ã€ŒåŠ æ¬ŠæŠ½æ¨£ã€æ‰¾ Top10ï¼Œä¸æœƒåˆ—èˆ‰å…¨éƒ¨çµ„åˆã€‚
</div>

<div class="card">
  <label>è¡°æ¸›æ¬Šé‡ r</label>
  <div class="row">
    <input id="r" type="number" step="0.01" value="0.8" min="0" max="1" style="max-width:100px">
    <button class="btn sec" type="button" onclick="setR(0.6)">r=0.6</button>
    <button class="btn sec" type="button" onclick="setR(0.8)">r=0.8</button>
    <button class="btn sec" type="button" onclick="setR(0.95)">r=0.95</button>
  </div>

  <div class="row" style="margin-top:8px">
    <label class="switch"><input type="checkbox" id="streak" checked> ğŸ” ç†±è™Ÿé€£é–‹æ‡²ç½°</label>
    <label class="switch"><input type="checkbox" id="avoidRepeat" checked onchange="toggleStrict()"> é¿å…é‡è¤‡ä¸Šä¸€æœŸ</label>
    <label id="strictWrap"><input type="checkbox" id="strictRepeat"> åš´æ ¼æ’é™¤ï¼ˆé‡è¤‡ â‰¥2 é¡†ç›´æ¥å‰ƒé™¤ï¼‰</label>
    <label class="switch"><input type="checkbox" id="neighbor" checked> Â±2 é„°è¿‘åŠ æ¬Š</label>
  </div>

  <label style="margin-top:8px">æˆ‘çš„ä¸‹æ³¨ï¼ˆäº”é¡†ä¸€çµ„ï¼Œæ¯è¡Œä¸€çµ„ï¼‰</label>
  <textarea id="bets" placeholder="ä¾‹å¦‚ï¼š24 34 58 67 84&#10;8 29 50 69 92"></textarea>

  <div class="row" style="margin-top:8px">
    <button class="btn" type="button" onclick="run()">è¨ˆç®—/é æ¸¬</button>
  </div>

  <div class="divider" style="margin:10px 0"></div>
  <label>æ–°å¢æœ€æ–°ä¸€æœŸï¼ˆäº”é¡†ï¼‰</label>
  <input id="latest" placeholder="ä¾‹å¦‚ï¼š27 35 37 43 71">
  <div class="row">
    <button class="btn" type="button" onclick="appendLatest()">ï¼‹ åŠ å…¥åˆ°æ­·å²</button>
    <button class="btn sec" type="button" onclick="clearAdded()">é‡ç½®æœ¬æ©Ÿæ–°å¢</button>
  </div>

  <div class="divider" style="margin:10px 0"></div>
  <label>æŠ½æ¨£æ¬¡æ•¸ï¼ˆè¶Šå¤§è¶Šæº–ï¼Œä½†è¶Šæ…¢ï¼‰</label>
  <input id="samples" type="number" value="50000" min="1000" step="1000" style="max-width:160px">
</div>

<div class="card">
  <h3>ğŸ”¢ å„è™Ÿç¢¼æ©Ÿç‡åˆ†ä½ˆï¼ˆTop10ï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af;margin-bottom:4px">
    å–®è™Ÿå¹³å‡ç†è«–æ©Ÿç‡ï¼šç´„ 5.05%ï¼ˆå®Œå…¨éš¨æ©Ÿï¼š5/99ï¼‰
  </div>
  <div id="singleTop" class="mono split2" style="margin-top:6px;">
    <div style="grid-column:1 / -1;font-size:13px;color:#9ca3af">å°šæœªè¨ˆç®—ï¼Œè«‹å…ˆæŒ‰ã€Œè¨ˆç®—/é æ¸¬ã€ã€‚</div>
  </div>
</div>

<div class="card">
  <h3>ğŸ’¡ æœ€æ–°æ¨è–¦çµæœï¼ˆTop1ï½Top10ï¼Œäº”é¡†ï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af;margin-bottom:4px">
    ç”±åŠ æ¬ŠæŠ½æ¨£æŒ‘é¸åˆ†æ•¸æœ€é«˜çš„ 10 çµ„ï¼ˆéåˆ—èˆ‰å…¨éƒ¨çµ„åˆï¼‰
  </div>
  <div id="toplist" class="mono split2" style="margin-top:6px;"></div>
</div>

<div class="card">
  <h3>ğŸ“Š å„æ•¸å­—ç´¯è¨ˆé–‹å‡ºæ¬¡æ•¸ï¼ˆå«æœ¬æ©Ÿæ–°å¢ï¼‰</h3>
  <div id="countGrid" class="mono split2" style="margin-top:6px;"></div>
  <div id="countSummary" style="font-size:12px;color:#9ca3af;margin-top:4px"></div>
</div>

<div class="card">
  <h3>æˆ‘çš„ä¸‹æ³¨çµæœ</h3>
  <div id="myres" class="mono" style="font-size:13px;color:#94a3b8">å°šæœªè¨ˆç®—</div>
</div>

<div class="card">
  <h3>ğŸ“ˆ å‘½ä¸­ç´€éŒ„è¡¨ï¼ˆå›æ¸¬ï¼šä»¥ TopN é æ¸¬ä¸‹ä¸€æœŸï¼‰</h3>
  <div style="font-size:12px;color:#9ca3af;margin-bottom:6px">
    å›æ¸¬æ¡ç”¨å‰
    <select id="topN" onchange="run()" style="width:auto;display:inline-block;background:#020617;color:#e5e7eb;border:1px solid rgba(148,163,184,.6);border-radius:999px;padding:2px 10px;font-size:12px;margin:0 4px;">
      <option value="1">1</option>
      <option value="3" selected>3</option>
      <option value="5">5</option>
      <option value="10">10</option>
    </select>
    çµ„
  </div>
  <div id="hitSummary" style="font-size:12px;color:#9ca3af;margin-bottom:4px">å°šæœªå›æ¸¬ã€‚è«‹å…ˆæŒ‰ã€Œè¨ˆç®—/é æ¸¬ã€ã€‚</div>
  <div class="hit-table-wrapper">
    <table class="hit-table" id="hitTable">
      <thead>
        <tr>
          <th>æœŸæ•¸</th>
          <th>é–‹çè™Ÿç¢¼</th>
          <th>æœ€ä½³å‘½ä¸­</th>
          <th>å‘½ä¸­çµ„åˆï¼ˆæœ€ä½³ï¼‰</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
const N_NUM = 99;
const DRAW_K = 5;

// å…§å»ºæ­·å²è³‡æ–™ï¼ˆå·²åŠ å…¥å‰å…©æœŸï¼‰
const baseHistory = [
  [18, 48, 69, 91, 13],
  [53, 56, 49, 37, 20],
  [21, 82, 45, 20, 71],
  [54, 77, 18, 20, 66],
  [42, 33, 39, 35, 21],
  [22, 62, 99, 45, 64],
  [89, 33, 68, 04, 92]
];

const LS_KEY = "bingo_extraHist_v1";
let added = JSON.parse(localStorage.getItem(LS_KEY) || "[]");

function toggleStrict(){
  document.getElementById("strictWrap").style.display =
    document.getElementById("avoidRepeat").checked ? "inline-block" : "none";
}
toggleStrict();

function setR(v){ document.getElementById("r").value = v; }
function getAll(){ return baseHistory.concat(added); }

function appendLatest(){
  const v = document.getElementById("latest").value.trim().split(/\s+/).map(Number);
  if(v.length===DRAW_K && v.every(n=>Number.isFinite(n) && n>=1 && n<=N_NUM)){
    const uniq=[...new Set(v)];
    if(uniq.length!==DRAW_K){ alert("åŒä¸€æœŸè™Ÿç¢¼ä¸å¯é‡è¤‡"); return; }
    added.push(uniq);
    localStorage.setItem(LS_KEY, JSON.stringify(added));
    updateStats();
    alert("å·²åŠ å…¥ï¼");
    document.getElementById("latest").value="";
  }else{
    alert(`è«‹è¼¸å…¥ ${DRAW_K} å€‹ 1~${N_NUM} çš„æ•¸å­—`);
  }
}
function clearAdded(){
  if(confirm("ç¢ºå®šæ¸…é™¤ï¼Ÿ")){
    added=[];
    localStorage.removeItem(LS_KEY);
    updateStats();
  }
}

function updateStats(){
  const histAll=getAll();
  const total=histAll.length;
  const latest=(histAll[total-1]||[]).join(" ");
  document.getElementById("stats").innerHTML =
    `ğŸ“Š ç›®å‰å…±æœ‰ ${total} æœŸï¼ˆå« ${added.length} æœŸæœ¬æ©Ÿæ–°å¢ï¼‰<br>æœ€æ–°ä¸€æœŸï¼š${latest||"â€”"}`;
  const counts=tallyCounts(histAll);
  renderCounts(counts,histAll);
}
updateStats();

function singleProbsByR(hist,r,sp){
  const w=Array(N_NUM).fill(0), n=hist.length;
  for(let i=0;i<n;i++){
    const ww=Math.pow(r,n-1-i);
    for(const x of hist[i]) w[x-1]+=ww;
  }
  if(sp && n>0){
    for(let num=1;num<=N_NUM;num++){
      let streak=0, miss=0, maxStreak=0, maxMiss=0;
      for(let i=0;i<n;i++){
        if(hist[i].includes(num)){ streak++; maxStreak=Math.max(maxStreak,streak); miss=0; }
        else{ miss++; maxMiss=Math.max(maxMiss,miss); streak=0; }
      }
      if(maxStreak>=3) w[num-1]*=0.85;
      if(maxStreak>=4) w[num-1]*=0.75;
      if(maxMiss>=8)   w[num-1]*=1.10;
      if(maxMiss>=12)  w[num-1]*=1.18;
    }
  }
  const s=w.reduce((a,b)=>a+b,0) || 1;
  return w.map(v=>v/s);
}

function applyNeighborBoost(probs,hist){
  const n=hist.length;
  if(n===0) return probs.slice();
  const last=hist[n-1];
  const boosted=probs.slice();
  const boost1=1.08, boost2=1.04;
  for(const x of last){
    for(const d of [-2,-1,1,2]){
      const y=x+d;
      if(y>=1 && y<=N_NUM){
        boosted[y-1]*=(Math.abs(d)===1?boost1:boost2);
      }
    }
  }
  const s=boosted.reduce((a,b)=>a+b,0) || 1;
  return boosted.map(v=>v/s);
}

function scoreCombo(combo, probs, hist, avoid, strict){
  let sc=0;
  for(const x of combo){
    const p=probs[x-1] || 1e-12;
    sc += Math.log(p);
  }
  const sorted=[...combo].sort((a,b)=>a-b);
  let adj=0;
  for(let i=1;i<sorted.length;i++) if(sorted[i]-sorted[i-1]===1) adj++;
  if(adj>=2) sc -= 0.25;
  if(adj>=3) sc -= 0.60;

  const min=sorted[0], max=sorted[sorted.length-1];
  if(max-min<=12) sc -= 0.25;

  if(hist.length){
    const last=hist[hist.length-1];
    const same=combo.filter(x=>last.includes(x)).length;
    if(avoid){
      if(strict && same>=2) return -Infinity;
      if(same===1) sc -= 0.12;
      if(same===2) sc -= 0.35;
      if(same===3) sc -= 0.80;
      if(same>=4) sc -= 1.50;
    }
  }
  return sc;
}

// æ”¹è‰¯æŠ½æ¨£ï¼škey = log(u)/wï¼ˆé¿å… u^(1/w) åœ¨ w å¾ˆå°æ™‚å…¨éƒ¨è¶¨è¿‘ 0ï¼‰
function weightedSampleWithoutReplacement(probs, k){
  const keys=[];
  for(let i=1;i<=N_NUM;i++){
    const w=Math.max(probs[i-1], 1e-12);
    const u=Math.random();
    const key=Math.log(u) / w;
    keys.push({num:i, key});
  }
  keys.sort((a,b)=>b.key-a.key);
  return keys.slice(0,k).map(x=>x.num);
}

function computeTopCombosBySampling(hist, probs, avoid, strict, samples){
  const top=[];
  const seen=new Set();
  for(let s=0;s<samples;s++){
    const combo=weightedSampleWithoutReplacement(probs, DRAW_K).sort((a,b)=>a-b);
    const key=combo.join(",");
    if(seen.has(key)) continue;
    seen.add(key);

    const sc=scoreCombo(combo, probs, hist, avoid, strict);
    if(!Number.isFinite(sc)) continue;

    if(top.length<10){
      top.push({combo, sc});
      top.sort((a,b)=>b.sc-a.sc);
    }else if(sc>top[top.length-1].sc){
      top[top.length-1]={combo, sc};
      top.sort((a,b)=>b.sc-a.sc);
    }
  }
  return top;
}

function fmtScoreToIndicator(sc){ return sc.toFixed(4); }

function tallyCounts(hist){
  const counts=Array(N_NUM).fill(0);
  for(const draw of hist) for(const x of draw) counts[x-1]++;
  return counts;
}

function renderCounts(counts,hist){
  const totalBalls = hist.length * DRAW_K;
  const items = counts.map((c,i)=>({num:i+1,c,p:totalBalls?c/totalBalls:0}))
    .sort((a,b)=>b.c-a.c).slice(0,10);

  const left=items.slice(0,5), right=items.slice(5,10);
  const chipHtml=o=>`
    <div class="chip">
      <span class="label">è™Ÿç¢¼ ${o.num}</span>
      <span class="value">${o.c} æ¬¡ï½œ${(o.p*100).toFixed(2)}%</span>
    </div>`;
  document.getElementById("countGrid").innerHTML =
    `<div>${left.map(chipHtml).join("")}</div><div>${right.map(chipHtml).join("")}</div>`;
  document.getElementById("countSummary").textContent =
    `ç´¯è¨ˆ ${hist.length} æœŸï¼Œå…± ${totalBalls} é¡†æ¬¡ã€‚é¡¯ç¤ºå‡ºç¾æ¬¡æ•¸ Top10ã€‚`;
}

function updateSingleTop(probs){
  const arr=probs.map((p,i)=>({num:i+1,p})).sort((a,b)=>b.p-a.p).slice(0,10);
  const left=arr.slice(0,5), right=arr.slice(5,10);
  const render=(o,rank)=>{
    const cls=rank<=3?"chip rankTop":"chip";
    return `<div class="${cls}">
      <span class="label">#${rank} è™Ÿç¢¼ ${o.num}</span>
      <span class="value">${(o.p*100).toFixed(3)}%</span>
    </div>`;
  };
  document.getElementById("singleTop").innerHTML =
    `<div>${left.map((o,i)=>render(o,i+1)).join("")}</div><div>${right.map((o,i)=>render(o,i+6)).join("")}</div>`;
}

function backtestTopN(hist,r,sp,avoid,strict,neighbor,topN,samples){
  const n=hist.length, rows=[];
  if(n<3) return rows;
  for(let i=1;i<n-1;i++){
    const train=hist.slice(0,i+1);
    const target=hist[i+1];
    let probs=singleProbsByR(train,r,sp);
    if(neighbor) probs=applyNeighborBoost(probs, train);

    const top=computeTopCombosBySampling(train, probs, avoid, strict, Math.max(8000, Math.floor(samples/5)))
      .slice(0, topN);

    let bestHit=0;
    const hitCombos=[];
    for(const item of top){
      const hit=item.combo.filter(x=>target.includes(x)).length;
      if(hit>0) hitCombos.push({combo:item.combo, hit});
      if(hit>bestHit) bestHit=hit;
    }
    rows.push({issue:i+2,target,bestHit,hitCombos});
  }
  return rows;
}

function renderHits(rows,topN){
  const summary=document.getElementById("hitSummary");
  const tbody=document.querySelector("#hitTable tbody");
  if(!rows.length){
    summary.textContent="æ­·å²æœŸæ•¸ä¸è¶³ï¼Œç„¡æ³•å›æ¸¬ï¼ˆè‡³å°‘éœ€è¦ 3 æœŸï¼‰ã€‚";
    tbody.innerHTML="";
    return;
  }
  const totalAll=rows.length;
  const displayRows= totalAll>30 ? rows.slice(-30) : rows;

  let c5=0,c4=0,c3=0,c2=0,c1=0,c0=0,any=0;
  for(const r of displayRows){
    if(r.bestHit>=1) any++;
    if(r.bestHit===5) c5++; else if(r.bestHit===4) c4++; else if(r.bestHit===3) c3++;
    else if(r.bestHit===2) c2++; else if(r.bestHit===1) c1++; else c0++;
  }
  summary.textContent =
    `å…± ${totalAll} æœŸï¼ˆé¡¯ç¤º ${displayRows.length} æœŸï¼‰ï¼›Top${topN} å›æ¸¬ï¼šè‡³å°‘ä¸­ 1 é¡† ${any} æœŸï¼›ä¸­5:${c5} ä¸­4:${c4} ä¸­3:${c3} ä¸­2:${c2} ä¸­1:${c1} 0ä¸­:${c0}`;

  let html="";
  for(const r of displayRows){
    const issue=`ç¬¬ ${r.issue} æœŸ`;
    const targetStr=r.target.join(" ");
    const hitLabel=r.bestHit?`${r.bestHit} é¡†`:"0 é¡†";
    let comboStr="â€”";
    if(r.hitCombos.length){
      const best=r.bestHit;
      comboStr=r.hitCombos.filter(x=>x.hit===best).map(x=>x.combo.join(" ")).join("ã€");
    }
    html += `<tr>
      <td style="width:90px;white-space:nowrap;">${issue}</td>
      <td>${targetStr}</td>
      <td>${hitLabel}</td>
      <td style="max-width:360px;word-break:break-all;">${comboStr}</td>
    </tr>`;
  }
  tbody.innerHTML=html;
}

function run(){
  const hist=getAll();
  let r=parseFloat(document.getElementById("r").value);
  if(!Number.isFinite(r) || r<=0 || r>=1){ r=0.8; document.getElementById("r").value="0.80"; }

  const sp=document.getElementById("streak").checked;
  const avoid=document.getElementById("avoidRepeat").checked;
  const strict=document.getElementById("strictRepeat").checked;
  const neighbor=document.getElementById("neighbor").checked;
  const topN=parseInt(document.getElementById("topN").value,10)||3;
  const samples=parseInt(document.getElementById("samples").value,10)||50000;

  let probs=singleProbsByR(hist,r,sp);
  if(neighbor) probs=applyNeighborBoost(probs,hist);

  updateSingleTop(probs);

  const top=computeTopCombosBySampling(hist,probs,avoid,strict,samples);
  const left=top.slice(0,5), right=top.slice(5,10);

  const scs = top.map(x=>x.sc);
  const maxSc = Math.max(...scs);
  const minSc = Math.min(...scs);
  const to100 = (sc)=>{
    if(maxSc===minSc) return 100;
    const v = (sc - minSc) * 100 / (maxSc - minSc);
    return Math.max(0, Math.min(100, Math.round(v)));
  };

  const renderCombo=(o,rank)=>{
    const cls=rank<=3?"chip rankTop":"chip";
    return `<div class="${cls}">
      <span class="label">Top${rank}ï½œ${o.combo.join(" ")}</span>
      <span class="value">åˆ†æ•¸ ${to100(o.sc)}/100</span>
    </div>`;
  };
  document.getElementById("toplist").innerHTML =
    `<div>${left.map((o,i)=>renderCombo(o,i+1)).join("")}</div><div>${right.map((o,i)=>renderCombo(o,i+6)).join("")}</div>`;

  const bets=document.getElementById("bets").value.trim();
  if(!bets){
    document.getElementById("myres").textContent="å°šæœªè¼¸å…¥ä¸‹æ³¨ã€‚";
  }else{
    const lines=bets.split(/\n+/).map(l=>l.trim()).filter(Boolean);
    const res=[];
    for(const l of lines){
      const arr=l.split(/\s+/).map(Number).filter(n=>Number.isFinite(n));
      if(arr.length!==DRAW_K){ res.push(`${l} â†’ æ ¼å¼éŒ¯èª¤`); continue; }
      const uniq=[...new Set(arr)];
      if(uniq.length!==DRAW_K){ res.push(`${l} â†’ å…§å«é‡è¤‡è™Ÿç¢¼`); continue; }
      const combo=uniq.sort((a,b)=>a-b);
      const sc=scoreCombo(combo,probs,hist,avoid,strict);
      const key=combo.join(",");
      const idx=top.findIndex(x=>x.combo.join(",")===key);
      const rankText=idx>=0?`ï¼ˆTop${idx+1}ï¼‰`:"";
      res.push(`${combo.join(" ")} â†’ åˆ†æ•¸ ${to100(sc)}/100 ${rankText}`);
    }
    document.getElementById("myres").textContent=res.join("\n");
  }

  const rows=backtestTopN(hist,r,sp,avoid,strict,neighbor,topN,samples);
  renderHits(rows,topN);
  updateStats();
}
</script>
</body>
</html>
